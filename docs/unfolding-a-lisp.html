<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="/unfolding-a-lisp" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Building a LISP interpreter in a way that resembles Alexander‚Äôs process of unfolding.">

  <meta property="og:site_name" content="Notes on The Nature of Order">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/styles.css">

  
  <meta property="og:description" content="Building a LISP interpreter in a way that resembles Alexander‚Äôs process of unfolding."/>
  

  
  <meta property="og:title" content="Unfolding a LISP">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2021-02-21T16:46:29+00:00">
  <meta property="article:author" content="/">
  

  <meta property="og:url" content="/unfolding-a-lisp" />

  

  <title>
    
      Unfolding a LISP &mdash; Notes on The Nature of Order
    
  </title>
</head>

  <body>
    <nav><div>
    <a class="internal-link" href="/"><b>Notes on The Nature of Order</b></a>
</div>
</nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>Unfolding a LISP</h1>
    <time datetime="2021-02-11T11:34:06+00:00">
      Last updated on February 11, 2021
      
    </time>
  </div>

  <div id="notes-entry-container">
    <content>
      <p>Building a LISP interpreter in a way that resembles Alexander‚Äôs process of unfolding.</p>

<p><em>Inspired and roughly based on <a href="https://github.com/kanaka/mal/blob/master/process/guide.md">https://github.com/kanaka/mal/blob/master/process/guide.md</a>.</em></p>

<h2 id="mapping-architecture-concepts-to-software">Mapping architecture concepts to software</h2>
<p>How do concepts from architecture map to software? Let‚Äôs try:</p>

<p>The material we build software with is code of a particular programming language. The technology we use are language-specific features and techniques common in that language. The result is a program running in an execution environment, either compiled for a certain machine instruction set or interpreted in the host process.</p>

<ul>
  <li>Programming language code = <em>material</em></li>
  <li>Language features = <em>technology</em></li>
  <li>Execution environment = <em>site</em>
    <ul>
      <li>compiled: (virtual) machine instruction set + state</li>
      <li>interpreted: host process + runtime + state</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Materials and technology change from era to era. It is in the nature of human society that these things evolve and will be different with each period of history. But within the enormous variation of materials and technique which inevitably change from age to age, we may identify certain invariants that must arise repeatedly, from the fundamental process.[^b3.c16.s13]</p>
</blockquote>

<p>If code and language features are the material and technology of building software, and if these are expected to change, then we need a more abstract pattern language to describe generic sequences that can be used to describe certain functionality, but in a language-agnostic way.</p>

<h2 id="a-project-that-unfolds">A project that unfolds</h2>
<p>The <em>Make-A-Lisp</em> project describes the implementation of an application ‚Äî a LISP interpreter ‚Äî in a sequence of 11 steps. Each step builds on the result of the former step. And each step results in an executable, and testable, application. In that way, the project guide can be considered a <em>sequence</em> written in a <em>pattern language</em> in the Alexandrian sense. And if you look at the architecture diagrams for each step, you‚Äôll find that the structure unfolds in differentiating steps.</p>

<p>As far as I can tell, the project wasn‚Äôt designed with Alexander in mind; it just happens to be an example of an unfolding process.</p>

<p>Let‚Äôs look which centers we can find in each step.</p>

<h3 id="step-0-read-eval-print-loop-repl">Step 0: Read-Eval-Print loop (REPL)</h3>
<blockquote>
  <p>This step is basically just creating a skeleton of your interpreter.</p>
</blockquote>

<p>The largest structure established in the first step is (a) a common pattern and (b) closely related to the user interface: users are expected to interact through a text-based terminal-like interface. You can enter a command, it will be processed, and the result will be printed on screen. Then it starts over, waiting for the next command. This is a REPL ‚Äî a read-eval-print loop.</p>

<p>The REPL becomes the first center, with a circular structure ‚Äî it repeats, potentially endlessly. As part of it, smaller centers are established within it as the steps that are repeated with each iteration:</p>

<ol>
  <li>The read step: read a command from the user</li>
  <li>The evaluation step: evaluate the command and compute the result</li>
  <li>The print step: print the result</li>
</ol>

<p>We end up with an executable program which doesn‚Äôt do much yet, but it does loop through reading a command and printing it (without any evaluation).</p>

<p><em>What‚Äôs a bit confusing is that the structure of a program is more of a process than it is a static structure. Although we can clearly see how the process has more static parts ‚Äî the 3-step loop structure isn‚Äôt going to change ‚Äî and more dynamic parts ‚Äî the exact user input will be unknown until we run the finished program, so we won‚Äôt be able to assume much about it (apart from its structure‚Ä¶ oh well, more meta levels of circular references).</em></p>

<h3 id="step-1-read-and-print">Step 1: Read and Print</h3>
<blockquote>
  <p>In this step, your interpreter will ‚Äúread‚Äù the string from the user and parse it into an internal tree data structure (an abstract syntax tree) and then take that data structure and ‚Äúprint‚Äù it back to a string.</p>
</blockquote>

<p>The second step focuses on the <em>Read</em> and the <em>Print</em> centers. Although much of the interesting stuff is going to happen with the <em>Evaluate</em> center, we can‚Äôt quite do anything there until we put some infrastructure in place ‚Äî we need to be able to work with the input from the user.</p>

<p>First, we need to parse the input from its text representation into a structure we can work with: we break the input down into smaller components and arrange them in a tree structure ‚Äî in a way this is also a differentiation process strengthening the latent centers in the string and turning them into strong centers. This process is known as parsing; we basically created a <em>Parser</em> as a new center within <em>Read</em>. The parsed abstract syntax tree (AST) is then passed over to the <em>Evaluate</em> center/step.</p>

<p><em>Parsing is another one of these well-understood patterns with lots of different flavors of implementation. A parser, therefore, can be seen as a complex center which has itself been unfolded from a generic sequence that describes how to build a parser. In software development we usually default to a pre-made component and many of the implementations that are part of the _Mal_ project do import libraries for this.</em></p>

<p>We ignore <em>Evaluate</em> for now and just pass the AST through to the <em>Print</em> center/step.</p>

<p>Then, in the <em>Print</em> center/step, we need to do the opposite of parsing to turn the tree back into a string. This direction is much easier because we go from a more complex hierarchical structure to a much simpler sequential structure. We create a <em>Printer</em> as a new center within <em>Print</em>.</p>

<p><em>Here the project diverges somewhat from a ‚Äúproper‚Äù unfolding process as it suggests implementing a parser for the whole language in this step, including constructs that won‚Äôt become essential until much later in the sequence. A properly unfolded process would restrict itself to only what is required in this step, or otherwise the most simple version of differentiation that strengthens latent centers (in this case I‚Äôd interpret ‚Äúlatent‚Äù as functionality which might not be required right now in this step, but is already clearly visible on the horizon for the step likely to be taken next.).</em></p>

<p>This step in the sequence is made of two steps which each take a center and strengthen it by introducing a smaller center within it:</p>

<ol>
  <li><em>Read</em>: <em>Parser</em></li>
  <li><em>Print</em>: <em>Printer</em></li>
</ol>

<p><em>Not sure how useful it is to split these into separate steps in the sequence‚Ä¶? To get to an executable program, both centers need to be in place. They are duals that depend on each other ‚Äî perhaps one way symmetries manifest in the structure of this application.</em></p>

<h3 id="step-2">Step 2:</h3>
<blockquote>
  <p>In step 1 your mal interpreter was basically just a way to validate input and eliminate extraneous white space. In this step you will turn your interpreter into a simple number calculator by adding functionality to the evaluator (EVAL).</p>
</blockquote>

<p>This step now focuses on the <em>Evaluate</em> center/step, and establishes three new centers within it: It introduces an environment (holding four operations) and then differentiates the existing <code class="language-plaintext highlighter-rouge">eval</code> function into two <code class="language-plaintext highlighter-rouge">eval</code> and <code class="language-plaintext highlighter-rouge">eval_ast</code> functions.</p>

<p><em>I have yet to fully understand why that second part ‚Äî splitting <code class="language-plaintext highlighter-rouge">eval</code> into two separate functions ‚Äî is necessary. In my implementation I kept them as one and it works fine. Perhaps this is another premature introduction of structure that will become important much later in the sequence?</em></p>

    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      
      <div style="display: grid; grid-gap: 1em; grid-template-columns: repeat(1fr);">
      
        <div class="backlink-box">
        <a class="internal-link" href="/growing-a-lisp-with-structure-preserving-transformations">Growing a LISP with structure-preserving transformations</a><br>
        <div style="font-size: 0.9em">An experiment to find ways to explore the solution space of program implementations in a way that resembles unfolding and...</div>
        </div>
      
        <div class="backlink-box">
        <a class="internal-link" href="/inspired-inklings">Ideas inspired by The Nature of Order</a><br>
        <div style="font-size: 0.9em">Unfinished inklings which I don‚Äôt yet know where to put exactly, so I just collect them here for now:
</div>
        </div>
      
        <div class="backlink-box">
        <a class="internal-link" href="/overspecification-and-ambiguity">Successively adding detail ‚Äî over-specification and ambiguity</a><br>
        <div style="font-size: 0.9em">Successively adding detail to a description of a process (meta, I know), is exactly how you make software. Software development...</div>
        </div>
      
      </div>
      
    </side>
  </div>
</article>

<hr>

<p>Here are all the notes in this garden, along with their links, visualized as a graph.</p>

<style>
  .links line {
    stroke: #ccc;
    opacity: 0.5;
  }

  .nodes circle {
    cursor: pointer;
    fill: #8b88e6;
    transition: all 0.15s ease-out;
  }

  .text text {
    cursor: pointer;
    fill: #333;
    text-shadow: -1px -1px 0 #fafafabb, 1px -1px 0 #fafafabb, -1px 1px 0 #fafafabb, 1px 1px 0 #fafafabb;
  }

  .nodes [active],
  .text [active] {
    cursor: pointer;
    fill: black;
  }

  .inactive {
    opacity: 0.1;
    transition: all 0.15s ease-out;
  }

  #graph-wrapper {
    background: #fcfcfc;
    border-radius: 4px;
    height: auto;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
  integrity="sha512-FHsFVKQ/T1KWJDGSbrUhTJyS1ph3eRrxI228ND0EGaEp6v4a/vGwPWd3Dtd/+9cI7ccofZvl/wulICEurHN1pg=="
  crossorigin="anonymous"></script>

<div id="graph-wrapper">
  <script>
    const MINIMAL_NODE_SIZE = 8;
    const MAX_NODE_SIZE = 12;
    const ACTIVE_RADIUS_FACTOR = 1.5;
    const STROKE = 1;
    const FONT_SIZE = 16;
    const TICKS = 200;
    const FONT_BASELINE = 40;
    const MAX_LABEL_LENGTH = 50;

    const graphData = {"edges":[{"source":"857908678100630466503808743446736777245946","target":"2354524788135065464485626"},{"source":"769888470198844466060018847331908530558873763","target":"300430434931425362874673269409015792433966"},{"source":"3035549385423862016961693665","target":"183548063395729710752309486488239148"},{"source":"3035549385423862016961693665","target":"3035549385423839450055575211"},{"source":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065","target":"3035549385423839450055575211"},{"source":"70102857887716082586071","target":"3035549385423839450055575211"},{"source":"22318693368395279887915467576962319724042544435960","target":"3035549385423839450055575211"},{"source":"56305397781134474","target":"3035549385423839450055575211"},{"source":"209025262981167222348949720211778526470037672576409046548244729665210880565000","target":"3035549385423839450055575211"},{"source":"1465332931187170892246597329824211544976133598443415954","target":"3035549385423839450055575211"},{"source":"55456882061951757284950321137181298110445803352866808","target":"3035549385423839450055575211"},{"source":"138015836477012538048578345382051","target":"610601268545156228624720316487646442962654931095"},{"source":"3035549385423862016961693665","target":"610601268545156228624720316487646442962654931095"},{"source":"19942314977162414723513823267620212","target":"141776000055446617905145141791191"},{"source":"101463536200283027618","target":"141776000055446617905145141791191"},{"source":"394118713153500426474532463774188","target":"323352844319592415464693835620702358430418676836371564591063739297002084055993596066"},{"source":"897914293366293074021137910044424565705599234211","target":"525946610350913464215322484275206828027179782653"},{"source":"2117060942551920584560033182096905366420747536406781347199158764","target":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065"},{"source":"769888470198844466060018847331908530558873763","target":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065"},{"source":"41587875","target":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065"},{"source":"769888470198844466060018847331908530558873763","target":"25931234947877328235236994443881225742996373603609360312614784361913339830354312657846305576754"},{"source":"897914293366293074021137910044424565705599234211","target":"1500127540988700002"},{"source":"300865603773061682407149945800257995478","target":"1187267956188148"},{"source":"19942314977162414723513823267620212","target":"1187267956188148"},{"source":"47071575130226","target":"1187267956188148"},{"source":"136592926767635177224","target":"1187267956188148"},{"source":"769888470198844466060018847331908530558873763","target":"2117060942551920584560033182096905366420747536406781347199158764"},{"source":"41587875","target":"2117060942551920584560033182096905366420747536406781347199158764"},{"source":"10855440747984359874724883242017927076","target":"164369645439032318355293922150316"},{"source":"769888470198844466060018847331908530558873763","target":"164369645439032318355293922150316"},{"source":"750219939","target":"750219939"},{"source":"2742922964752102381518455","target":"750219939"},{"source":"1679629087642778762","target":"750219939"},{"source":"5305190528185464840076027338890","target":"750219939"},{"source":"19942314977162414723513823267620212","target":"750219939"},{"source":"209025262981167222348949720211778526470037672576409046548244729665210880565000","target":"750219939"},{"source":"769888470198844466060018847331908530558873763","target":"750219939"},{"source":"28701142501304850727677769139025986720354979","target":"750219939"},{"source":"134570461790540341000","target":"750219939"},{"source":"91661245000876","target":"750219939"},{"source":"750219939","target":"2742922964752102381518455"},{"source":"1679629087642778762","target":"165854062742294943484825760559459"},{"source":"769888470198844466060018847331908530558873763","target":"22318693368395279887915467576962319724042544435960"},{"source":"30408277722027967447232288423174753379414163448","target":"22318693368395279887915467576962319724042544435960"},{"source":"19942314977162414723513823267620212","target":"3807167697822622863255941860447761223862871857399843307515289824626036"},{"source":"141776000055446617905145141791191","target":"994053449837"},{"source":"19942314977162414723513823267620212","target":"994053449837"},{"source":"165854062742294943484825760559459","target":"1679629087642778762"},{"source":"5305190528185464840076027338890","target":"1679629087642778762"},{"source":"28701142501304850727677769139025986720354979","target":"1679629087642778762"},{"source":"19942314977162414723513823267620212","target":"300865603773061682407149945800257995478"},{"source":"4701053458907636276591417210","target":"161235937480716038511925267829620398621356383440071107370114297"},{"source":"897914293366293074021137910044424565705599234211","target":"161235937480716038511925267829620398621356383440071107370114297"},{"source":"64028557324129785503","target":"64028557324129785503"},{"source":"23775038621120774401398070950256476818110844422636","target":"64028557324129785503"},{"source":"205086215272400159040928900","target":"64028557324129785503"},{"source":"64028557324129785503","target":"23775038621120774401398070950256476818110844422636"},{"source":"205086215272400159040928900","target":"23775038621120774401398070950256476818110844422636"},{"source":"1679629087642778762","target":"5305190528185464840076027338890"},{"source":"19942314977162414723513823267620212","target":"867506644"},{"source":"10352158015576759593461996759545082","target":"56305397781134474"},{"source":"3035549385423839450055575211","target":"19942314977162414723513823267620212"},{"source":"141776000055446617905145141791191","target":"19942314977162414723513823267620212"},{"source":"1187267956188148","target":"19942314977162414723513823267620212"},{"source":"3807167697822622863255941860447761223862871857399843307515289824626036","target":"19942314977162414723513823267620212"},{"source":"994053449837","target":"19942314977162414723513823267620212"},{"source":"300865603773061682407149945800257995478","target":"19942314977162414723513823267620212"},{"source":"867506644","target":"19942314977162414723513823267620212"},{"source":"47071575130226","target":"19942314977162414723513823267620212"},{"source":"47276175750688","target":"19942314977162414723513823267620212"},{"source":"11638740229698754415378407875843687796","target":"19942314977162414723513823267620212"},{"source":"769888470198844466060018847331908530558873763","target":"19942314977162414723513823267620212"},{"source":"137644679755132510675489719307113287591928026101344429700039804276","target":"19942314977162414723513823267620212"},{"source":"101463536200283027618","target":"19942314977162414723513823267620212"},{"source":"133112004493865846745844","target":"19942314977162414723513823267620212"},{"source":"145476784631087098850476","target":"19942314977162414723513823267620212"},{"source":"121722738156913886366","target":"19942314977162414723513823267620212"},{"source":"78117008014252","target":"19942314977162414723513823267620212"},{"source":"13723482444686270392931635943826346","target":"19942314977162414723513823267620212"},{"source":"136592926767635177224","target":"19942314977162414723513823267620212"},{"source":"64179605461","target":"19942314977162414723513823267620212"},{"source":"750219939","target":"209025262981167222348949720211778526470037672576409046548244729665210880565000"},{"source":"10855440747984359874724883242017927076","target":"209025262981167222348949720211778526470037672576409046548244729665210880565000"},{"source":"1119503268046576693933788799714950026369287264","target":"209025262981167222348949720211778526470037672576409046548244729665210880565000"},{"source":"10352158015576759593461996759545082","target":"1677622113911780389649186182582959272181366607014309236618"},{"source":"750219939","target":"4541600259536822073669822905"},{"source":"769888470198844466060018847331908530558873763","target":"4541600259536822073669822905"},{"source":"6417439954945033502946793822","target":"4541600259536822073669822905"},{"source":"897914293366293074021137910044424565705599234211","target":"477411559917371500709851418376700914882448"},{"source":"1679629087642778762","target":"100759890665887256092116"},{"source":"897914293366293074021137910044424565705599234211","target":"100759890665887256092116"},{"source":"161235937480716038511925267829620398621356383440071107370114297","target":"4701053458907636276591417210"},{"source":"897914293366293074021137910044424565705599234211","target":"4701053458907636276591417210"},{"source":"141776000055446617905145141791191","target":"47071575130226"},{"source":"19942314977162414723513823267620212","target":"47071575130226"},{"source":"101463536200283027618","target":"47071575130226"},{"source":"19942314977162414723513823267620212","target":"47276175750688"},{"source":"30704","target":"102978783333107716768322"},{"source":"205086215272400159040928900","target":"102978783333107716768322"},{"source":"769888470198844466060018847331908530558873763","target":"10855440747984359874724883242017927076"},{"source":"13460978412168991559156884570174806150786220","target":"1465332931187170892246597329824211544976133598443415954"},{"source":"769888470198844466060018847331908530558873763","target":"1465332931187170892246597329824211544976133598443415954"},{"source":"55456882061951757284950321137181298110445803352866808","target":"1465332931187170892246597329824211544976133598443415954"},{"source":"1384620","target":"897914293366293074021137910044424565705599234211"},{"source":"19942314977162414723513823267620212","target":"11638740229698754415378407875843687796"},{"source":"138015836477012538048578345382051","target":"769888470198844466060018847331908530558873763"},{"source":"19942314977162414723513823267620212","target":"137644679755132510675489719307113287591928026101344429700039804276"},{"source":"19942314977162414723513823267620212","target":"101463536200283027618"},{"source":"128729417383866138007238617924","target":"221882673515924857498257995735"},{"source":"78117008014252","target":"221882673515924857498257995735"},{"source":"300430434931425362874673269409015792433966","target":"10352158015576759593461996759545082"},{"source":"128729417383866138007238617924","target":"10352158015576759593461996759545082"},{"source":"22318693368395279887915467576962319724042544435960","target":"10352158015576759593461996759545082"},{"source":"56305397781134474","target":"10352158015576759593461996759545082"},{"source":"769888470198844466060018847331908530558873763","target":"10352158015576759593461996759545082"},{"source":"78117008014252","target":"10352158015576759593461996759545082"},{"source":"19942314977162414723513823267620212","target":"133112004493865846745844"},{"source":"897914293366293074021137910044424565705599234211","target":"1059864631337712197757777314496580482493980325847"},{"source":"750219939","target":"3984879238478975840632819514587402900813828653823088219142610696"},{"source":"3035549385423862016961693665","target":"30408277722027967447232288423174753379414163448"},{"source":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065","target":"30408277722027967447232288423174753379414163448"},{"source":"22318693368395279887915467576962319724042544435960","target":"30408277722027967447232288423174753379414163448"},{"source":"769888470198844466060018847331908530558873763","target":"30408277722027967447232288423174753379414163448"},{"source":"6417439954945033502946793822","target":"30408277722027967447232288423174753379414163448"},{"source":"9508397820164555640062186432534","target":"30408277722027967447232288423174753379414163448"},{"source":"28701142501304850727677769139025986720354979","target":"30408277722027967447232288423174753379414163448"},{"source":"1119503268046576693933788799714950026369287264","target":"30408277722027967447232288423174753379414163448"},{"source":"769888470198844466060018847331908530558873763","target":"6417439954945033502946793822"},{"source":"10352158015576759593461996759545082","target":"6417439954945033502946793822"},{"source":"769888470198844466060018847331908530558873763","target":"85785093551411052995361780846544060518131352208111836288890"},{"source":"19942314977162414723513823267620212","target":"145476784631087098850476"},{"source":"10855440747984359874724883242017927076","target":"55456882061951757284950321137181298110445803352866808"},{"source":"769888470198844466060018847331908530558873763","target":"20013325161157380289674549503821970223482"},{"source":"6417439954945033502946793822","target":"20013325161157380289674549503821970223482"},{"source":"41587875","target":"20013325161157380289674549503821970223482"},{"source":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065","target":"41587875"},{"source":"22318693368395279887915467576962319724042544435960","target":"41587875"},{"source":"56305397781134474","target":"41587875"},{"source":"769888470198844466060018847331908530558873763","target":"41587875"},{"source":"10352158015576759593461996759545082","target":"41587875"},{"source":"6417439954945033502946793822","target":"41587875"},{"source":"41587875","target":"41587875"},{"source":"205086215272400159040928900","target":"7258777541606685391153001709676512508332504447624439957332754004586017187"},{"source":"139334011108470505105","target":"7258777541606685391153001709676512508332504447624439957332754004586017187"},{"source":"22318693368395279887915467576962319724042544435960","target":"9508397820164555640062186432534"},{"source":"56305397781134474","target":"9508397820164555640062186432534"},{"source":"769888470198844466060018847331908530558873763","target":"9508397820164555640062186432534"},{"source":"141776000055446617905145141791191","target":"121722738156913886366"},{"source":"19942314977162414723513823267620212","target":"121722738156913886366"},{"source":"47071575130226","target":"121722738156913886366"},{"source":"138015836477012538048578345382051","target":"205086215272400159040928900"},{"source":"102978783333107716768322","target":"205086215272400159040928900"},{"source":"139334011108470505105","target":"205086215272400159040928900"},{"source":"750219939","target":"28701142501304850727677769139025986720354979"},{"source":"1679629087642778762","target":"28701142501304850727677769139025986720354979"},{"source":"19942314977162414723513823267620212","target":"78117008014252"},{"source":"221882673515924857498257995735","target":"78117008014252"},{"source":"750219939","target":"22510515597061798942567864962425931374344"},{"source":"769888470198844466060018847331908530558873763","target":"292900691829611997468003165334"},{"source":"750219939","target":"134570461790540341000"},{"source":"56305397781134474","target":"134570461790540341000"},{"source":"897914293366293074021137910044424565705599234211","target":"1071258256525709045072819797514049906745013498"},{"source":"897914293366293074021137910044424565705599234211","target":"14357143319525786425398317879739388870016332133127969692276783298763118607746"},{"source":"19942314977162414723513823267620212","target":"13723482444686270392931635943826346"},{"source":"145476784631087098850476","target":"13723482444686270392931635943826346"},{"source":"141776000055446617905145141791191","target":"136592926767635177224"},{"source":"19942314977162414723513823267620212","target":"136592926767635177224"},{"source":"101463536200283027618","target":"136592926767635177224"},{"source":"138015836477012538048578345382051","target":"297334331408014797863880803692"},{"source":"688183928546371541082371129812436529315","target":"297334331408014797863880803692"},{"source":"102978783333107716768322","target":"139334011108470505105"},{"source":"30704","target":"139334011108470505105"},{"source":"7258777541606685391153001709676512508332504447624439957332754004586017187","target":"139334011108470505105"},{"source":"100759890665887256092116","target":"857907477500630605094836148502523565059990"},{"source":"4701053458907636276591417210","target":"857907477500630605094836148502523565059990"},{"source":"101463536200283027618","target":"857907477500630605094836148502523565059990"},{"source":"3984879238478975840632819514587402900813828653823088219142610696","target":"857907477500630605094836148502523565059990"},{"source":"2354524788135065464485626","target":"857908678100630466503808743446736777245946"},{"source":"10352158015576759593461996759545082","target":"857908678100630466503808743446736777245946"},{"source":"2058480153971394222768797363875885907950882635921146","target":"857908678100630466503808743446736777245946"},{"source":"323352844319592415464693835620702358430418676836371564591063739297002084055993596066","target":"394118713153500426474532463774188"},{"source":"23775038621120774401398070950256476818110844422636","target":"394118713153500426474532463774188"},{"source":"769888470198844466060018847331908530558873763","target":"394118713153500426474532463774188"},{"source":"19942314977162414723513823267620212","target":"64179605461"},{"source":"101463536200283027618","target":"64179605461"},{"source":"145476784631087098850476","target":"64179605461"},{"source":"13723482444686270392931635943826346","target":"64179605461"},{"source":"102978783333107716768322","target":"1384620"},{"source":"10855440747984359874724883242017927076","target":"1119503268046576693933788799714950026369287264"},{"source":"304323355106374775796561012127735004536596982479575049973492353875310652887640","target":"5228498860424063994985"},{"source":"897914293366293074021137910044424565705599234211","target":"5228498860424063994985"},{"source":"24421275379937252756481113288107645030703286276906265438548323641030948362428121814","target":"5228498860424063994985"},{"source":"297334331408014797863880803692","target":"688183928546371541082371129812436529315"},{"source":"750219939","target":"91661245000876"},{"source":"128729417383866138007238617924","target":"91661245000876"},{"source":"13460978412168991559156884570174806150786220","target":"91661245000876"},{"source":"769888470198844466060018847331908530558873763","target":"91661245000876"},{"source":"10352158015576759593461996759545082","target":"91661245000876"},{"source":"20263910718826209293466482319469241990","target":"91661245000876"},{"source":"9309112070462081897821561324","target":"91661245000876"},{"source":"19942314977162414723513823267620212","target":"26267914112269400546803422350264930895220"}],"nodes":[{"id":"2354524788135065464485626","path":"/a-new-view-of-nature","label":"A new view of nature"},{"id":"300430434931425362874673269409015792433966","path":"/about-the-nature-of-the-universe","label":"About the nature of the universe"},{"id":"138015836477012538048578345382051","path":"/about-this-project","label":"About the Nature of Order"},{"id":"183548063395729710752309486488239148","path":"/alexander-and-cybernetics","label":"Alexander and Cybernetics"},{"id":"3035549385423839450055575211","path":"/alexander-and-lakoff","label":"Alexander and Lakoff"},{"id":"610601268545156228624720316487646442962654931095","path":"/alexander-and-religion","label":"Christopher Alexander and Religion"},{"id":"3035549385423862016961693665","path":"/alexander-in-context","label":"Alexander in context"},{"id":"141776000055446617905145141791191","path":"/alternating-repetition","label":"Alternating repetition"},{"id":"323352844319592415464693835620702358430418676836371564591063739297002084055993596066","path":"/always-look-one-level-above-and-below-your-current-level-of-scale","label":"Always look one level above and below your current level of scale"},{"id":"525946610350913464215322484275206828027179782653","path":"/are-peoples-wishes-really-universal","label":"Are peoples‚Äô wishes really universal?"},{"id":"33343682239645771409939292508083099954817723402506449049756345884410240766348288491742522024390065","path":"/arrangement-in-space-is-fundamental-to-how-we-understand-our-world","label":"Arrangement in space (and time) is fundamental to how we understand our world"},{"id":"25931234947877328235236994443881225742996373603609360312614784361913339830354312657846305576754","path":"/authentic-architecture-with-deep-feeling-has-become-almost-impossible","label":"Authentic architecture with deep feeling has become almost impossible"},{"id":"1500127540988700002","path":"/beauty-in-code","label":"Beauty in code"},{"id":"70102857887716082586071","path":"/beyond-cognition","label":"Beyond cognition"},{"id":"1187267956188148","path":"/boundaries","label":"Boundaries"},{"id":"2117060942551920584560033182096905366420747536406781347199158764","path":"/building-is-an-essential-order-creation-process","label":"Building is an essential order-creation process"},{"id":"164369645439032318355293922150316","path":"/can-we-talk-about-feeling","label":"Can we talk about ‚Äúfeeling‚Äù‚Ä¶?"},{"id":"750219939","path":"/center","label":"Center"},{"id":"2742922964752102381518455","path":"/centers-and-design","label":"Centers and design"},{"id":"165854062742294943484825760559459","path":"/centers-help-one-another","label":"Centers help one another"},{"id":"128729417383866138007238617924","path":"/character-vs-features","label":"Character vs. features"},{"id":"22318693368395279887915467576962319724042544435960","path":"/consequences-of-the-mechanistic-view","label":"Consequences of the mechanistic view"},{"id":"3807167697822622863255941860447761223862871857399843307515289824626036","path":"/contemporary-architecture-avoids-the-15-properties","label":"Contemporary architecture avoids the 15 properties"},{"id":"994053449837","path":"/contrast","label":"Contrast"},{"id":"1679629087642778762","path":"/creating-life","label":"Creating life"},{"id":"13460978412168991559156884570174806150786220","path":"/cultural-variation-of-wholeness","label":"Cultural variation of wholeness"},{"id":"300865603773061682407149945800257995478","path":"/deep-interlock-and-ambiguity","label":"Deep interlock and ambiguity"},{"id":"39638516230515886813202776475221501117544623472600012447","path":"/development-tools","label":"üõ† Development tools for this digital garden"},{"id":"161235937480716038511925267829620398621356383440071107370114297","path":"/differences-between-software-and-architecture","label":"Where software and architecture are different"},{"id":"64028557324129785503","path":"/digital-garden","label":"Digital Garden"},{"id":"23775038621120774401398070950256476818110844422636","path":"/digital-gardening-is-a-living-process","label":"Digital gardening is a living process"},{"id":"5305190528185464840076027338890","path":"/each-center-has-its-life","label":"Each center has its life"},{"id":"867506644","path":"/echoes","label":"Echoes"},{"id":"56305397781134474","path":"/feeling-life","label":"Feeling life"},{"id":"19942314977162414723513823267620212","path":"/fifteen-fundamental-properties","label":"15 fundamental properties"},{"id":"209025262981167222348949720211778526470037672576409046548244729665210880565000","path":"/from-boundaries-to-centers","label":"Binary vs. gradual perspectives ‚Äî from boundaries to centers"},{"id":"1677622113911780389649186182582959272181366607014309236618","path":"/from-ecology-to-a-broader-conception-of-life","label":"From ecology to a broader conception of life"},{"id":"4541600259536822073669822905","path":"/function-vs-ornament","label":"Function vs. ornament"},{"id":"477411559917371500709851418376700914882448","path":"/general-and-repurposable-tools","label":"General and repurposable tools"},{"id":"100759890665887256092116","path":"/geometry-in-music","label":"Geometry in music"},{"id":"4701053458907636276591417210","path":"/geometry-in-software","label":"Geometry in software"},{"id":"47071575130226","path":"/good-shape","label":"Good shape"},{"id":"47276175750688","path":"/gradients","label":"Gradients"},{"id":"304323355106374775796561012127735004536596982479575049973492353875310652887640","path":"/growing-a-lisp-with-structure-preserving-transformations","label":"Growing a LISP with structure-preserving transformations"},{"id":"102978783333107716768322","path":"/growing-this-site","label":"Growing this site"},{"id":"10855440747984359874724883242017927076","path":"/helpful-foundational-ideas","label":"Helpful foundational ideas"},{"id":"1465332931187170892246597329824211544976133598443415954","path":"/human-feeling-is-90-percent-the-same-across-people","label":"Human feeling is 90% the same across people"},{"id":"897914293366293074021137910044424565705599234211","path":"/inspired-inklings","label":"Ideas inspired by The Nature of Order"},{"id":"11638740229698754415378407875843687796","path":"/interplay-of-the-properties","label":"Interplay of the properties"},{"id":"769888470198844466060018847331908530558873763","path":"/key-concepts","label":"Key concepts in The Nature of Order"},{"id":"137644679755132510675489719307113287591928026101344429700039804276","path":"/learning-to-recognize-and-apply-the-15-properties","label":"Learning to recognize and apply the 15 properties"},{"id":"101463536200283027618","path":"/levels-of-scale","label":"Levels of scale"},{"id":"221882673515924857498257995735","path":"/life-and-imperfection","label":"Life and imperfection"},{"id":"10352158015576759593461996759545082","path":"/life","label":"Life and living structure"},{"id":"133112004493865846745844","path":"/local-symmetries","label":"Local symmetries"},{"id":"1059864631337712197757777314496580482493980325847","path":"/loosing-the-sense-of-true-connection","label":"Loosing the sense of true connection"},{"id":"3984879238478975840632819514587402900813828653823088219142610696","path":"/mathematical-and-physical-existence-of-centers","label":"Mathematical and physical existence of centers"},{"id":"30408277722027967447232288423174753379414163448","path":"/mechanical-rationalist-world-view","label":"Mechanical-rationalist world view"},{"id":"6417439954945033502946793822","path":"/mechanism-vs-harmony","label":"Mechanism vs. harmony"},{"id":"85785093551411052995361780846544060518131352208111836288890","path":"/mechanization-in-architecture-and-software","label":"Mechanization in architecture and software"},{"id":"144169488718773065503070400174926712949364807197843576579582818578","path":"/metaphorical-structure-in-the-two-arches-example","label":"Metaphorical structure in the two arches example"},{"id":"145476784631087098850476","path":"/not-separateness","label":"Not-separateness"},{"id":"30704","path":"/now","label":"Now"},{"id":"55456882061951757284950321137181298110445803352866808","path":"/objective-vs-subjective","label":"Objective vs. subjective ‚Äî a new worldview"},{"id":"20013325161157380289674549503821970223482","path":"/order-is-difficult-to-describe","label":"Order is difficult to describe"},{"id":"41587875","path":"/order","label":"Order"},{"id":"24421275379937252756481113288107645030703286276906265438548323641030948362428121814","path":"/overspecification-and-ambiguity","label":"Successively adding detail ‚Äî over-specification and ambiguity"},{"id":"7258777541606685391153001709676512508332504447624439957332754004586017187","path":"/places-for-interaction","label":"Interactive places discussing Christopher Alexander"},{"id":"9508397820164555640062186432534","path":"/pluralist-view-of-value","label":"Pluralist view of value"},{"id":"121722738156913886366","path":"/positive-space","label":"Positive space"},{"id":"205086215272400159040928900","path":"/project-objectives","label":"Project Objectives"},{"id":"28701142501304850727677769139025986720354979","path":"/recursive-definition-of-a-center","label":"Recursive definition of a center"},{"id":"78117008014252","path":"/roughness","label":"Roughness"},{"id":"22510515597061798942567864962425931374344","path":"/rules-for-identifying-centers","label":"Rules for identifying centers"},{"id":"292900691829611997468003165334","path":"/search-for-real-beauty","label":"Search for real beauty"},{"id":"134570461790540341000","path":"/seeing-centers","label":"Seeing centers"},{"id":"1071258256525709045072819797514049906745013498","path":"/send-program-not-datastructure","label":"Send a program, not a data structure"},{"id":"14357143319525786425398317879739388870016332133127969692276783298763118607746","path":"/shared-understanding-is-needed-to-have-meaningful-debate","label":"Shared understanding is needed to have meaningful debate"},{"id":"13723482444686270392931635943826346","path":"/simplicity-and-inner-calm","label":"Simplicity and inner calm"},{"id":"136592926767635177224","path":"/strong-centers","label":"Strong centers"},{"id":"297334331408014797863880803692","path":"/structure-of-the-books","label":"Structure of the books"},{"id":"139334011108470505105","path":"/telegram-group","label":"Telegram Group"},{"id":"857907477500630605094836148502523565059990","path":"/the-architecture-of-complexity","label":"The Architecture of Complexity"},{"id":"857908678100630466503808743446736777245946","path":"/the-concept-of-living-structure","label":"The concept of living structure"},{"id":"394118713153500426474532463774188","path":"/the-fundamental-process","label":"The fundamental process"},{"id":"64179605461","path":"/the-void","label":"The void"},{"id":"1384620","path":"/todo","label":"Todo"},{"id":"1119503268046576693933788799714950026369287264","path":"/top-down-vs-bottom-up","label":"Top-down vs. bottom-up ‚Äî whole vs. parts"},{"id":"5228498860424063994985","path":"/unfolding-a-lisp","label":"Unfolding a LISP"},{"id":"688183928546371541082371129812436529315","path":"/unfolding-the-nature-of-order","label":"Unfolding the Nature of Order"},{"id":"20263910718826209293466482319469241990","path":"/wholeness-changes-over-time","label":"Wholeness changes over time"},{"id":"9309112070462081897821561324","path":"/wholeness-in-physics","label":"Wholeness in physics"},{"id":"91661245000876","path":"/wholeness","label":"Wholeness"},{"id":"26267914112269400546803422350264930895220","path":"/why-15-fundamental-properties","label":"Why 15 fundamental properties?"},{"id":"2058480153971394222768797363875885907950882635921146","path":"/why-the-15-properties-occur-in-nature","label":"Why do the 15 properties occur in nature?"}]}
    let nodesData = graphData.nodes;
    let linksData = graphData.edges;

    const nodeSize = {};

    const updateNodeSize = () => {
      nodesData.forEach((el) => {
        let weight =
          3 *
          Math.sqrt(
            linksData.filter((l) => l.source === el.id || l.target === el.id)
              .length + 1
          );
        if (weight < MINIMAL_NODE_SIZE) {
          weight = MINIMAL_NODE_SIZE;
        } else if (weight > MAX_NODE_SIZE) {
          weight = MAX_NODE_SIZE;
        }
        nodeSize[el.id] = weight;
      });
    };

    const onClick = (d) => {
      window.location = d.path
    };

    const onMouseover = function (d) {
      const relatedNodesSet = new Set();
      linksData
        .filter((n) => n.target.id == d.id || n.source.id == d.id)
        .forEach((n) => {
          relatedNodesSet.add(n.target.id);
          relatedNodesSet.add(n.source.id);
        });

      node.attr("class", (node_d) => {
        if (node_d.id !== d.id && !relatedNodesSet.has(node_d.id)) {
          return "inactive";
        }
        return "";
      });

      link.attr("class", (link_d) => {
        if (link_d.source.id !== d.id && link_d.target.id !== d.id) {
          return "inactive";
        }
        return "";
      });

      link.attr("stroke-width", (link_d) => {
        if (link_d.source.id === d.id || link_d.target.id === d.id) {
          return STROKE * 4;
        }
        return STROKE;
      });
      text.attr("class", (text_d) => {
        if (text_d.id !== d.id && !relatedNodesSet.has(text_d.id)) {
          return "inactive";
        }
        return "";
      });
    };

    const onMouseout = function (d) {
      node.attr("class", "");
      link.attr("class", "");
      text.attr("class", "");
      link.attr("stroke-width", STROKE);
    };

    const sameNodes = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const map = new Map();
      for (const node of previous) {
        map.set(node.id, node.label);
      }

      for (const node of next) {
        const found = map.get(node.id);
        if (!found || found !== node.title) {
          return false;
        }
      }

      return true;
    };

    const sameEdges = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const set = new Set();
      for (const edge of previous) {
        set.add(`${edge.source.id}-${edge.target.id}`);
      }

      for (const edge of next) {
        if (!set.has(`${edge.source}-${edge.target}`)) {
          return false;
        }
      }

      return true;
    };

    const graphWrapper = document.getElementById('graph-wrapper')
    const element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    element.setAttribute("width", graphWrapper.getBoundingClientRect().width);
    element.setAttribute("height", window.innerHeight * 0.8);
    graphWrapper.appendChild(element);

    const reportWindowSize = () => {
      element.setAttribute("width", window.innerWidth);
      element.setAttribute("height", window.innerHeight);
    };

    window.onresize = reportWindowSize;

    const svg = d3.select("svg");
    const width = Number(svg.attr("width"));
    const height = Number(svg.attr("height"));
    let zoomLevel = 1;

    const simulation = d3
      .forceSimulation(nodesData)
      .force("forceX", d3.forceX().x(width / 2))
      .force("forceY", d3.forceY().y(height / 2))
      .force("charge", d3.forceManyBody())
      .force(
        "link",
        d3
          .forceLink(linksData)
          .id((d) => d.id)
          .distance(70)
      )
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(80))
      .stop();

    const g = svg.append("g");
    let link = g.append("g").attr("class", "links").selectAll(".link");
    let node = g.append("g").attr("class", "nodes").selectAll(".node");
    let text = g.append("g").attr("class", "text").selectAll(".text");

    const resize = () => {
      if (d3.event) {
        const scale = d3.event.transform;
        zoomLevel = scale.k;
        g.attr("transform", scale);
      }

      const zoomOrKeep = (value) => (zoomLevel >= 1 ? value / zoomLevel : value);

      const font = Math.max(Math.round(zoomOrKeep(FONT_SIZE)), 1);

      text.attr("font-size", (d) => font);
      text.attr("y", (d) => d.y - zoomOrKeep(FONT_BASELINE) + 8);
      link.attr("stroke-width", zoomOrKeep(STROKE));
      node.attr("r", (d) => {
        return zoomOrKeep(nodeSize[d.id]);
      });
      svg
        .selectAll("circle")
        .filter((_d, i, nodes) => d3.select(nodes[i]).attr("active"))
        .attr("r", (d) => zoomOrKeep(ACTIVE_RADIUS_FACTOR * nodeSize[d.id]));

      document.getElementById("zoom").innerHTML = zoomLevel.toFixed(2);
    };

    const ticked = () => {
      node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
      text
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y - (FONT_BASELINE - nodeSize[d.id]) / zoomLevel);
      link
        .attr("x1", (d) => d.source.x)
        .attr("y1", (d) => d.source.y)
        .attr("x2", (d) => d.target.x)
        .attr("y2", (d) => d.target.y);
    };

    const restart = () => {
      updateNodeSize();
      node = node.data(nodesData, (d) => d.id);
      node.exit().remove();
      node = node
        .enter()
        .append("circle")
        .attr("r", (d) => {
          return nodeSize[d.id];
        })
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(node);

      link = link.data(linksData, (d) => `${d.source.id}-${d.target.id}`);
      link.exit().remove();
      link = link.enter().append("line").attr("stroke-width", STROKE).merge(link);

      text = text.data(nodesData, (d) => d.label);
      text.exit().remove();
      text = text
        .enter()
        .append("text")
        .text((d) => shorten(d.label.replace(/_*/g, ""), MAX_LABEL_LENGTH))
        .attr("font-size", `${FONT_SIZE}px`)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "central")
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(text);

      node.attr("active", (d) => isCurrentPath(d.path) ? true : null);
      text.attr("active", (d) => isCurrentPath(d.path) ? true : null);

      simulation.nodes(nodesData);
      simulation.force("link").links(linksData);
      simulation.alpha(1).restart();
      simulation.stop();

      for (let i = 0; i < TICKS; i++) {
        simulation.tick();
      }

      ticked();
    };

    const zoomHandler = d3.zoom().scaleExtent([0.2, 3]).on("zoom", resize);

    zoomHandler(svg);
    restart();

    function isCurrentPath(notePath) {
      return window.location.pathname.includes(notePath)
    }

    function shorten(str, maxLen, separator = ' ') {
      if (str.length <= maxLen) return str;
      return str.substr(0, str.lastIndexOf(separator, maxLen)) + '...';
    }
  </script>
</div>
</main>
      <footer>Unfolding the Nature of Order :: <a class="internal-link" href="/about">About</a>
</footer>
    </div>

    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>

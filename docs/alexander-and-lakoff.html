<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="/alexander-and-lakoff" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Copied from a discussion in the Building Beauty forum. Slightly edited for better understanding without the context of that discussion.">

  <meta property="og:site_name" content="Notes on The Nature of Order">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/styles.css">

  
  <meta property="og:description" content="Copied from a discussion in the Building Beauty forum. Slightly edited for better understanding without the context of that discussion."/>
  

  
  <meta property="og:title" content="Alexander and Lakoff">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2021-01-20T17:51:17+00:00">
  <meta property="article:author" content="/">
  

  <meta property="og:url" content="/alexander-and-lakoff" />

  

  <title>
    
      Alexander and Lakoff &mdash; Notes on The Nature of Order
    
  </title>
</head>

  <body>
    <nav><div>
    <a class="internal-link" href="/"><b>Notes on The Nature of Order</b></a>
</div>
</nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>Alexander and Lakoff</h1>
    <time datetime="2021-01-19T13:49:49+00:00">
      Last updated on January 19, 2021
      
    </time>
  </div>

  <div id="notes-entry-container">
    <content>
      <p><em>Copied from a discussion in the Building Beauty forum. Slightly edited for better understanding without the context of that discussion.</em></p>

<p>I’ve been scratching my head about this ever since I started reading NoO. With his criticism about the Cartesian-rationalist world view, Alexander is clearly arguing against objectivism (external reality, humans are reduced to perceiving that reality but are basically not part of the model) and he proposes a different world-view that makes the experiencing individual part of the model. That sounds a lot like Lakoff to me, who also makes the case against objectivism, and also subjectivism (everything is just perception, there isn’t really any external reality), an alternative world view that Alexander also rejects. (I’m oversimplifying the world view descriptions somewhat, but it might help understanding for people not familiar with Lakoff’s work.)</p>

<p>Lakoff presents a well-researched and empirically supported world view in <em>Women, Fire, and Dangerous Things</em> which he calls Experientialism that does make the experiencing individual part of the model but without the downsides of subjectivism and by preserving the notion of a shared reality. 
It seems like what Alexander struggles to “sell” as science in NoO, in particular in the <span title="There is no note that matches this link." class="invalid-link">
  <span class="invalid-link-brackets">[[</span>
  Mirror of the Self
  <span class="invalid-link-brackets">]]</span></span> chapters, maps shockingly well to what Lakoff defines as Experientialism, which is — as far as I can tell — excruciatingly well backed by research.</p>

<p>I was wondering if there have been others, perhaps even Alexander and Lakoff themselves, making that connection?</p>

<p>Going deeper on later research in cognitive science it seems rather obvious to me that there must be a strong connection between the notion of <span title="There is no note that matches this link." class="invalid-link">
  <span class="invalid-link-brackets">[[</span>
  centers]] and the [[fifteen properties
  <span class="invalid-link-brackets">]]</span></span> and deeply rooted cognitive facilities like spatial metaphor and kinesthetic image schemas which Lakoff talks about (this is too hard to explain in a footnote here, but if you ask me to do it and you bring some time we can absolutely go there :-).</p>

<p>There is some further research published after Lakoff’s book, which has the potential to provide a much more substantial scientific explanation on how our perception of centers and their geometric composition works in our brains, in full compliance with everything Alexander states as part of the <span title="There is no note that matches this link." class="invalid-link">
  <span class="invalid-link-brackets">[[</span>
  mirror-of-the-self
  <span class="invalid-link-brackets">]]</span></span> test.</p>

<p>If you are aware of any research in that area that takes both Alexander’s and Lakoff’s work as starting points and tries to combine them to add more color to the cognitive basis for the perception and embodiment of centers and the 15 properties, please get in touch!</p>

<p>Anyway, if anyone read this far and found this interesting but has no clue what I’m talking about, I’d recommend George Lakoff’s <em>Metaphors We Live By</em> as an accessible introduction into some of the surprising insights how human language, thinking, and understanding work and how it is based on embodied cognition (is that the “<span title="There is no note that matches this link." class="invalid-link">
  <span class="invalid-link-brackets">[[</span>
  feeling
  <span class="invalid-link-brackets">]]</span></span>” Alexander talks about?) and a lot of spatial metaphors. And then please tell me if you can also see the connections or if I’m just hallucinating all this.</p>

<hr />

<p>Over the last three years I’ve been bringing these things up countless times in several different (computer people) communities where I saw important connections, but all I got was the virtual equivalent of a blank stare because nobody had explored these topics and it is difficult to get across what I am talking about without any context. They’re not to blame — it is definitely weird to meet well-read computer scientists that have also taken the time to go deep into design, cognitive science, and architecture. You can find a select few that went deep on either one of these, but this exact combination is obviously rare.</p>

<p>My (still very limited) understanding of linguistics is that Chomsky, who I only know from his information theoretic work and generative grammars that made it into computer science, represents the front of generative linguists, whereas Lakoff with some others represent an opposing front of cognitive linguists and that the war metaphor is somewhat appropriate.</p>

<p><em>Women, Fire, and Dangerous Things</em> seems to be Lakoff’s ultimate work where he takes on generative linguistics once and for all and dismantles it, pointing out all its shortcomings and compiling a vast amount of theories and research by countless scientists that spans several decades all lined up in a sequence of a compelling argument why embodied cognition and Experientialism are superior over objectivism (aka mechanist-rational), subjectivism and some other fringe theories in that field. Granted, Lakoff clearly takes a side here, but as a scientific argument it feels pretty darn comprehensive to me — I have seen few academic works with that level of comprehensiveness and scientific rigor. Unfortunately, that makes the book a rather challenging read — it easily took 3 months of my life to work through it, but I’d say it was worth every second. Which means that groundbreaking insights are inaccessible to some who need to know about them the most. That’s why I usually recommend Lakoff’s <em>Metaphors</em> instead; it’s a much lighter read, and hopefully draws people in enough to want to learn more.</p>

<p>Lakoff went on focusing on political language, which is interesting (and quite important for the US at the moment), but certainly less relevant to what we discuss here, although it strikes me as a similar move from figuring out the why and how to looking for contemporary application of what he found out is true and works — again something that he seems to share with Alexander.</p>

<p>Though Lakoff does from time to time appear to give lectures where he talks about the latest developments in cognitive science and how recent experiments do verify some of the theories about embodied cognition, universal metaphor, and image schemas as the core building blocks of how our brain makes sense of our environment and experience (cue McGilchrist to somehow fit into this).</p>

<p>Lakoff and Chomsky as the important forebears of getting us to this point aside, it is in the current generation of scientists that follow in their footsteps where I have the most hope to see progress that ultimately benefits us in building both physical and digital things that are more aligned with our human nature, simply because we understand it better. That doesn’t take anything away from the impressive work Chomsky, Lakoff, Alexander et al. have brought into this world, but hopefully will make their insights more accessible to a broader audience — and that is quite specifically something that we could do here, as a group, today.</p>

    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      
      <div style="display: grid; grid-gap: 1em; grid-template-columns: repeat(1fr);">
      
        <div class="backlink-box">
        <a class="internal-link" href="/human-feeling-is-90-percent-the-same-across-people">Human feeling is 90% the same across people</a><br>
        <div style="font-size: 0.9em">Alexander’s theory rests on an important perspective about human beings: that compared to each other, we are much more similar...</div>
        </div>
      
      </div>
      
    </side>
  </div>
</article>

<hr>

<p>Here are all the notes in this garden, along with their links, visualized as a graph.</p>

<style>
  .links line {
    stroke: #ccc;
    opacity: 0.5;
  }

  .nodes circle {
    cursor: pointer;
    fill: #8b88e6;
    transition: all 0.15s ease-out;
  }

  .text text {
    cursor: pointer;
    fill: #333;
    text-shadow: -1px -1px 0 #fafafabb, 1px -1px 0 #fafafabb, -1px 1px 0 #fafafabb, 1px 1px 0 #fafafabb;
  }

  .nodes [active],
  .text [active] {
    cursor: pointer;
    fill: black;
  }

  .inactive {
    opacity: 0.1;
    transition: all 0.15s ease-out;
  }

  #graph-wrapper {
    background: #fcfcfc;
    border-radius: 4px;
    height: auto;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
  integrity="sha512-FHsFVKQ/T1KWJDGSbrUhTJyS1ph3eRrxI228ND0EGaEp6v4a/vGwPWd3Dtd/+9cI7ccofZvl/wulICEurHN1pg=="
  crossorigin="anonymous"></script>

<div id="graph-wrapper">
  <script>
    const MINIMAL_NODE_SIZE = 8;
    const MAX_NODE_SIZE = 12;
    const ACTIVE_RADIUS_FACTOR = 1.5;
    const STROKE = 1;
    const FONT_SIZE = 16;
    const TICKS = 200;
    const FONT_BASELINE = 40;
    const MAX_LABEL_LENGTH = 50;

    const graphData = {"edges":[{"source":"769888470198844466060018847331908530558873763","target":"300430434931425362874673269409015792433966"},{"source":"1465332931187170892246597329824211544976133598443415954","target":"3035549385423839450055575211"},{"source":"138015836477012538048578345382051","target":"610601268545156228624720316487646442962654931095"},{"source":"394118713153500426474532463774188","target":"323352844319592415464693835620702358430418676836371564591063739297002084055993596066"},{"source":"769888470198844466060018847331908530558873763","target":"2117060942551920584560033182096905366420747536406781347199158764"},{"source":"41587875","target":"2117060942551920584560033182096905366420747536406781347199158764"},{"source":"64028557324129785503","target":"64028557324129785503"},{"source":"23775038621120774401398070950256476818110844422636","target":"64028557324129785503"},{"source":"205086215272400159040928900","target":"64028557324129785503"},{"source":"64028557324129785503","target":"23775038621120774401398070950256476818110844422636"},{"source":"205086215272400159040928900","target":"23775038621120774401398070950256476818110844422636"},{"source":"897914293366293074021137910044424565705599234211","target":"477411559917371500709851418376700914882448"},{"source":"897914293366293074021137910044424565705599234211","target":"100759890665887256092116"},{"source":"897914293366293074021137910044424565705599234211","target":"4701053458907636276591417210"},{"source":"30704","target":"102978783333107716768322"},{"source":"205086215272400159040928900","target":"102978783333107716768322"},{"source":"769888470198844466060018847331908530558873763","target":"1465332931187170892246597329824211544976133598443415954"},{"source":"1384620","target":"897914293366293074021137910044424565705599234211"},{"source":"138015836477012538048578345382051","target":"769888470198844466060018847331908530558873763"},{"source":"300430434931425362874673269409015792433966","target":"1003658"},{"source":"769888470198844466060018847331908530558873763","target":"1003658"},{"source":"769888470198844466060018847331908530558873763","target":"132179602421078339089658"},{"source":"897914293366293074021137910044424565705599234211","target":"1059864631337712197757777314496580482493980325847"},{"source":"769888470198844466060018847331908530558873763","target":"85785093551411052995361780846544060518131352208111836288890"},{"source":"2117060942551920584560033182096905366420747536406781347199158764","target":"41587875"},{"source":"769888470198844466060018847331908530558873763","target":"41587875"},{"source":"1003658","target":"41587875"},{"source":"205086215272400159040928900","target":"7258777541606685391153001709676512508332504447624439957332754004586017187"},{"source":"138015836477012538048578345382051","target":"205086215272400159040928900"},{"source":"102978783333107716768322","target":"205086215272400159040928900"},{"source":"769888470198844466060018847331908530558873763","target":"292900691829611997468003165334"},{"source":"897914293366293074021137910044424565705599234211","target":"14357143319525786425398317879739388870016332133127969692276783298763118607746"},{"source":"138015836477012538048578345382051","target":"297334331408014797863880803692"},{"source":"688183928546371541082371129812436529315","target":"297334331408014797863880803692"},{"source":"323352844319592415464693835620702358430418676836371564591063739297002084055993596066","target":"394118713153500426474532463774188"},{"source":"23775038621120774401398070950256476818110844422636","target":"394118713153500426474532463774188"},{"source":"769888470198844466060018847331908530558873763","target":"394118713153500426474532463774188"},{"source":"102978783333107716768322","target":"1384620"},{"source":"297334331408014797863880803692","target":"688183928546371541082371129812436529315"}],"nodes":[{"id":"300430434931425362874673269409015792433966","path":"/about-the-nature-of-the-universe","label":"About the nature of the universe"},{"id":"138015836477012538048578345382051","path":"/about-this-project","label":"About the Nature of Order"},{"id":"183548063395729710752309486488239148","path":"/alexander-and-cybernetics","label":"Alexander and Cybernetics"},{"id":"3035549385423839450055575211","path":"/alexander-and-lakoff","label":"Alexander and Lakoff"},{"id":"610601268545156228624720316487646442962654931095","path":"/alexander-and-religion","label":"Christopher Alexander and Religion"},{"id":"323352844319592415464693835620702358430418676836371564591063739297002084055993596066","path":"/always-look-one-level-above-and-below-your-current-level-of-scale","label":"Always look one level above and below your current level of scale"},{"id":"2117060942551920584560033182096905366420747536406781347199158764","path":"/building-is-an-essential-order-creation-process","label":"Building is an essential order-creation process"},{"id":"164369645439032318355293922150316","path":"/can-we-talk-about-feeling","label":"Can we talk about “feeling”…?"},{"id":"64028557324129785503","path":"/digital-garden","label":"Digital Garden"},{"id":"23775038621120774401398070950256476818110844422636","path":"/digital-gardening-is-a-living-process","label":"Digital gardening is a living process"},{"id":"477411559917371500709851418376700914882448","path":"/general-and-repurposable-tools","label":"General and repurposable tools"},{"id":"100759890665887256092116","path":"/geometry-in-music","label":"Geometry in music"},{"id":"4701053458907636276591417210","path":"/geometry-in-software","label":"Geometry in software"},{"id":"102978783333107716768322","path":"/growing-this-site","label":"Growing this site"},{"id":"1465332931187170892246597329824211544976133598443415954","path":"/human-feeling-is-90-percent-the-same-across-people","label":"Human feeling is 90% the same across people"},{"id":"897914293366293074021137910044424565705599234211","path":"/inspired-inklings","label":"Ideas inspired by The Nature of Order"},{"id":"769888470198844466060018847331908530558873763","path":"/key-concepts","label":"Key concepts in The Nature of Order"},{"id":"1003658","path":"/life","label":"Life"},{"id":"132179602421078339089658","path":"/living-structure","label":"Living structure"},{"id":"1059864631337712197757777314496580482493980325847","path":"/loosing-the-sense-of-true-connection","label":"Loosing the sense of true connection"},{"id":"85785093551411052995361780846544060518131352208111836288890","path":"/mechanization-in-architecture-and-software","label":"Mechanization in architecture and software"},{"id":"30704","path":"/now","label":"Now"},{"id":"41587875","path":"/order","label":"Order"},{"id":"7258777541606685391153001709676512508332504447624439957332754004586017187","path":"/places-for-interaction","label":"Interactive places discussing Christopher Alexander"},{"id":"205086215272400159040928900","path":"/project-objectives","label":"Project Objectives"},{"id":"292900691829611997468003165334","path":"/search-for-real-beauty","label":"Search for real beauty"},{"id":"14357143319525786425398317879739388870016332133127969692276783298763118607746","path":"/shared-understanding-is-needed-to-have-meaningful-debate","label":"Shared understanding is needed to have meaningful debate"},{"id":"297334331408014797863880803692","path":"/structure-of-the-books","label":"Structure of the books"},{"id":"394118713153500426474532463774188","path":"/the-fundamental-process","label":"The fundamental process"},{"id":"1384620","path":"/todo","label":"Todo"},{"id":"688183928546371541082371129812436529315","path":"/unfolding-the-nature-of-order","label":"Unfolding the Nature of Order"}]}
    let nodesData = graphData.nodes;
    let linksData = graphData.edges;

    const nodeSize = {};

    const updateNodeSize = () => {
      nodesData.forEach((el) => {
        let weight =
          3 *
          Math.sqrt(
            linksData.filter((l) => l.source === el.id || l.target === el.id)
              .length + 1
          );
        if (weight < MINIMAL_NODE_SIZE) {
          weight = MINIMAL_NODE_SIZE;
        } else if (weight > MAX_NODE_SIZE) {
          weight = MAX_NODE_SIZE;
        }
        nodeSize[el.id] = weight;
      });
    };

    const onClick = (d) => {
      window.location = d.path
    };

    const onMouseover = function (d) {
      const relatedNodesSet = new Set();
      linksData
        .filter((n) => n.target.id == d.id || n.source.id == d.id)
        .forEach((n) => {
          relatedNodesSet.add(n.target.id);
          relatedNodesSet.add(n.source.id);
        });

      node.attr("class", (node_d) => {
        if (node_d.id !== d.id && !relatedNodesSet.has(node_d.id)) {
          return "inactive";
        }
        return "";
      });

      link.attr("class", (link_d) => {
        if (link_d.source.id !== d.id && link_d.target.id !== d.id) {
          return "inactive";
        }
        return "";
      });

      link.attr("stroke-width", (link_d) => {
        if (link_d.source.id === d.id || link_d.target.id === d.id) {
          return STROKE * 4;
        }
        return STROKE;
      });
      text.attr("class", (text_d) => {
        if (text_d.id !== d.id && !relatedNodesSet.has(text_d.id)) {
          return "inactive";
        }
        return "";
      });
    };

    const onMouseout = function (d) {
      node.attr("class", "");
      link.attr("class", "");
      text.attr("class", "");
      link.attr("stroke-width", STROKE);
    };

    const sameNodes = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const map = new Map();
      for (const node of previous) {
        map.set(node.id, node.label);
      }

      for (const node of next) {
        const found = map.get(node.id);
        if (!found || found !== node.title) {
          return false;
        }
      }

      return true;
    };

    const sameEdges = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const set = new Set();
      for (const edge of previous) {
        set.add(`${edge.source.id}-${edge.target.id}`);
      }

      for (const edge of next) {
        if (!set.has(`${edge.source}-${edge.target}`)) {
          return false;
        }
      }

      return true;
    };

    const graphWrapper = document.getElementById('graph-wrapper')
    const element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    element.setAttribute("width", graphWrapper.getBoundingClientRect().width);
    element.setAttribute("height", window.innerHeight * 0.8);
    graphWrapper.appendChild(element);

    const reportWindowSize = () => {
      element.setAttribute("width", window.innerWidth);
      element.setAttribute("height", window.innerHeight);
    };

    window.onresize = reportWindowSize;

    const svg = d3.select("svg");
    const width = Number(svg.attr("width"));
    const height = Number(svg.attr("height"));
    let zoomLevel = 1;

    const simulation = d3
      .forceSimulation(nodesData)
      .force("forceX", d3.forceX().x(width / 2))
      .force("forceY", d3.forceY().y(height / 2))
      .force("charge", d3.forceManyBody())
      .force(
        "link",
        d3
          .forceLink(linksData)
          .id((d) => d.id)
          .distance(70)
      )
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(80))
      .stop();

    const g = svg.append("g");
    let link = g.append("g").attr("class", "links").selectAll(".link");
    let node = g.append("g").attr("class", "nodes").selectAll(".node");
    let text = g.append("g").attr("class", "text").selectAll(".text");

    const resize = () => {
      if (d3.event) {
        const scale = d3.event.transform;
        zoomLevel = scale.k;
        g.attr("transform", scale);
      }

      const zoomOrKeep = (value) => (zoomLevel >= 1 ? value / zoomLevel : value);

      const font = Math.max(Math.round(zoomOrKeep(FONT_SIZE)), 1);

      text.attr("font-size", (d) => font);
      text.attr("y", (d) => d.y - zoomOrKeep(FONT_BASELINE) + 8);
      link.attr("stroke-width", zoomOrKeep(STROKE));
      node.attr("r", (d) => {
        return zoomOrKeep(nodeSize[d.id]);
      });
      svg
        .selectAll("circle")
        .filter((_d, i, nodes) => d3.select(nodes[i]).attr("active"))
        .attr("r", (d) => zoomOrKeep(ACTIVE_RADIUS_FACTOR * nodeSize[d.id]));

      document.getElementById("zoom").innerHTML = zoomLevel.toFixed(2);
    };

    const ticked = () => {
      node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
      text
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y - (FONT_BASELINE - nodeSize[d.id]) / zoomLevel);
      link
        .attr("x1", (d) => d.source.x)
        .attr("y1", (d) => d.source.y)
        .attr("x2", (d) => d.target.x)
        .attr("y2", (d) => d.target.y);
    };

    const restart = () => {
      updateNodeSize();
      node = node.data(nodesData, (d) => d.id);
      node.exit().remove();
      node = node
        .enter()
        .append("circle")
        .attr("r", (d) => {
          return nodeSize[d.id];
        })
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(node);

      link = link.data(linksData, (d) => `${d.source.id}-${d.target.id}`);
      link.exit().remove();
      link = link.enter().append("line").attr("stroke-width", STROKE).merge(link);

      text = text.data(nodesData, (d) => d.label);
      text.exit().remove();
      text = text
        .enter()
        .append("text")
        .text((d) => shorten(d.label.replace(/_*/g, ""), MAX_LABEL_LENGTH))
        .attr("font-size", `${FONT_SIZE}px`)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "central")
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(text);

      node.attr("active", (d) => isCurrentPath(d.path) ? true : null);
      text.attr("active", (d) => isCurrentPath(d.path) ? true : null);

      simulation.nodes(nodesData);
      simulation.force("link").links(linksData);
      simulation.alpha(1).restart();
      simulation.stop();

      for (let i = 0; i < TICKS; i++) {
        simulation.tick();
      }

      ticked();
    };

    const zoomHandler = d3.zoom().scaleExtent([0.2, 3]).on("zoom", resize);

    zoomHandler(svg);
    restart();

    function isCurrentPath(notePath) {
      return window.location.pathname.includes(notePath)
    }

    function shorten(str, maxLen, separator = ' ') {
      if (str.length <= maxLen) return str;
      return str.substr(0, str.lastIndexOf(separator, maxLen)) + '...';
    }
  </script>
</div>
</main>
      <footer>Unfolding the Nature of Order :: <a class="internal-link" href="/about">About</a>
</footer>
    </div>

    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>
